# Development Dockerfile for API Service
# Optimized for hot reload with volume mounts

FROM node:20-alpine

# Install necessary packages for development
RUN apk add --no-cache \
    libc6-compat \
    postgresql-client \
    git

WORKDIR /app

# Copy package files first for better layer caching
COPY package*.json ./
COPY turbo.json ./
COPY packages/api/package*.json ./packages/api/
COPY packages/shared/package*.json ./packages/shared/

# Install dependencies
RUN npm ci

# Copy source files (will be overridden by volume mount in dev)
COPY packages/shared ./packages/shared
COPY packages/api ./packages/api

# Build shared package first (required by API)
RUN npm run build --workspace=@molthub/shared

# Expose port
EXPOSE 3000

# Default command (can be overridden in docker-compose)
CMD ["npm", "run", "dev", "--workspace=@molthub/api"]
